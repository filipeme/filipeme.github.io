<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="fav.png">
    <title>Cronograma de Atividades</title>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!--Google fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Poppins: ital, wght@0,100; 0,200; 0,300; 0,400; 0,500; 0,600; 0,700;0,800;0,900;1,100;1,200; 1,300; 1,400;1,500; 1,600;1,700;1,800; 1,900&display=swap" rel="stylesheet">

    <!-- Json manifest for mobile icon App -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000">
    
    <!-- Google Apps Script API -->
    <script src="https://apis.google.com/js/api.js"></script>
    
    <style>
        :root {
            --bg: #fff;
            --bg-primary: #18366c;
            --bg-container: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --tab-bg: #e2e8f0;
            --tab-text: #4a5568;
            --event-bg: #f7fafc;
            --work-color: #4299e1;
            --personal-color: #48bb78;
            --meeting-color: #ed8936;
            --spiritual-color: #9f7aea;
            --exercise-color: #f56565;
            --free-color: #a0aec0;
            --shadow: rgba(0,0,0,0.3);
            --scrollbar-track: #f1f1f1;
            --scrollbar-thumb: #888;
        }

        [data-theme="dark"] {
            --bg: #2d2d2d;
            --bg-primary: #36d1ef;
            --bg-container: #1a202c;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --border-color: #4a5568;
            --tab-bg: #2d3748;
            --tab-text: #cbd5e0;
            --event-bg: #2d3748;
            --shadow: rgba(0,0,0,0.6);
            --scrollbar-track: #2d3748;
            --scrollbar-thumb: #4a5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Scrollbar estilizada */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        body {
            font-family: "Poppins", sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 10px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: calc(100vw - 20px);
            margin: 0 auto;
            background: var(--bg-container);
            border-radius: 20px;
            padding: 20px;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            flex-shrink: 0;
        }

        .header-content {
            flex: 1;
            min-width: 250px;
        }

        .header h1 {
            font-size: 2em;
            color: var(--text-primary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 0.95em;
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 8px 16px;
            border: none;
            background: var(--tab-bg);
            color: var(--tab-text);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-btn:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .control-btn.primary {
            background: #163463;
            color: white;
        }

        .control-btn.success {
            background: transparent;
            border: 2px solid #38a169;
            color: #38a169;
        }
        .control-btn.success:hover {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .theme-toggle {
            background: var(--tab-bg);
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3em;
            transition: all 0.3s ease;
            color: var(--tab-text);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: rotate(180deg);
        }

        .view-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            flex-shrink: 0;
        }

        .view-btn {
            padding: 10px 24px;
            border: none;
            background: var(--tab-bg);
            color: var(--tab-text);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .view-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            flex-shrink: 0;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: var(--tab-bg);
            color: var(--tab-text);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-wrapper {
            position: relative;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 5px;
        }

        .day-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .day-content.active {
            display: block;
        }

        .overview-container {
            display: none;
            animation: fadeIn 0.5s ease;
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 10px;
        }

        .overview-container.active {
            display: block;
        }

        .month-container {
            display: none;
            animation: fadeIn 0.5s ease;
            padding: 10px;
        }

        .month-container.active {
            display: block;
        }

        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--event-bg);
            border-radius: 12px;
        }

        .month-header h2 {
            color: var(--text-primary);
            font-size: 1.8em;
            margin: 0;
        }

        .month-nav-btn {
            background: var(--tab-bg);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            color: var(--tab-text);
            transition: all 0.3s ease;
        }

        .month-nav-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.1);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 700;
            padding: 12px;
            background: var(--tab-bg);
            color: var(--text-primary);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .calendar-day {
            min-height: 120px;
            padding: 10px;
            background: var(--event-bg);
            border-radius: 10px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .calendar-day:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            border-color: #667eea;
            border-width: 3px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .calendar-day-number {
            font-weight: 700;
            font-size: 1.1em;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .calendar-day.today .calendar-day-number {
            color: #667eea;
            font-size: 1.3em;
        }

        .calendar-activity {
            font-size: 0.75em;
            padding: 4px 6px;
            margin-bottom: 3px;
            border-radius: 4px;
            border-left: 3px solid;
            background: rgba(255,255,255,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-activity:hover {
            transform: scale(1.05);
            z-index: 10;
            white-space: normal;
            position: relative;
        }

        .calendar-activity.work {
            border-left-color: var(--work-color);
            color: var(--work-color);
        }

        .calendar-activity.personal {
            border-left-color: var(--personal-color);
            color: var(--personal-color);
        }

        .calendar-activity.meeting {
            border-left-color: var(--meeting-color);
            color: var(--meeting-color);
        }

        .calendar-activity.spiritual {
            border-left-color: var(--spiritual-color);
            color: var(--spiritual-color);
        }

        .calendar-activity.exercise {
            border-left-color: var(--exercise-color);
            color: var(--exercise-color);
        }

        .calendar-activity.free {
            border-left-color: var(--free-color);
            color: var(--free-color);
        }

        .activity-count {
            font-size: 0.7em;
            color: var(--text-secondary);
            margin-top: 5px;
            font-style: italic;
        }

        .overview-grid {
            display: flex;
            gap: 15px;
            min-width: max-content;
            padding: 5px;
        }

        .day-card {
            background: var(--event-bg);
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #667eea;
            min-width: 280px;
            max-width: 280px;
            flex-shrink: 0;
        }

        .day-card h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
            position: sticky;
            top: 0;
            background: var(--event-bg);
            padding-bottom: 10px;
            z-index: 1;
        }

        .day-card .event {
            margin-bottom: 8px;
            padding: 8px;
            font-size: 0.8em;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .timeline {
            position: relative;
            padding-left: 25px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .event {
            position: relative;
            margin-bottom: 15px;
            padding: 15px;
            background: var(--event-bg);
            border-radius: 12px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .event:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .event.work {
            border-left-color: var(--work-color);
            background: linear-gradient(135deg, rgba(66, 153, 225, 0.1) 0%, rgba(66, 153, 225, 0.05) 100%);
        }

        .event.personal {
            border-left-color: var(--personal-color);
            background: linear-gradient(135deg, rgba(72, 187, 120, 0.1) 0%, rgba(72, 187, 120, 0.05) 100%);
        }

        .event.meeting {
            border-left-color: var(--meeting-color);
            background: linear-gradient(135deg, rgba(237, 137, 54, 0.1) 0%, rgba(237, 137, 54, 0.05) 100%);
        }

        .event.spiritual {
            border-left-color: var(--spiritual-color);
            background: linear-gradient(135deg, rgba(159, 122, 234, 0.1) 0%, rgba(159, 122, 234, 0.05) 100%);
        }

        .event.exercise {
            border-left-color: var(--exercise-color);
            background: linear-gradient(135deg, rgba(245, 101, 101, 0.1) 0%, rgba(245, 101, 101, 0.05) 100%);
        }

        .event.free {
            border-left-color: var(--free-color);
            background: linear-gradient(135deg, rgba(160, 174, 192, 0.1) 0%, rgba(160, 174, 192, 0.05) 100%);
        }

        .event-time {
            font-size: 1em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .event-title {
            font-size: 0.95em;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .event-tag {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: 600;
            margin-top: 6px;
            text-transform: uppercase;
        }

        .event-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .event-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-edit {
            background: #4299e1;
            color: white;
        }

        .btn-delete {
            background: #f56565;
            color: white;
        }

        .btn-edit:hover, .btn-delete:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .tag-work { background: var(--work-color); color: white; }
        .tag-personal { background: var(--personal-color); color: white; }
        .tag-meeting { background: var(--meeting-color); color: white; }
        .tag-spiritual { background: var(--spiritual-color); color: white; }
        .tag-exercise { background: var(--exercise-color); color: white; }
        .tag-free { background: var(--free-color); color: white; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--bg-container);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.5em;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }

        .close-modal:hover {
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95em;
            font-family: inherit;
            color: var(--text-primary);
            background: var(--bg-container);
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-cancel {
            background: var(--tab-bg);
            color: var(--tab-text);
        }

        .btn-save {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-modal:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            min-width: 300px;
            max-width: 400px;
            animation: slideInRight 0.5s ease;
            border-left: 5px solid;
            display: none;
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left-color: #48bb78;
        }

        .notification.error {
            border-left-color: #f56565;
        }

        .notification.warning {
            border-left-color: #ed8936;
        }

        .notification.reminder {
            border-left-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 1.1em;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .notification-body {
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .notification.reminder .notification-body {
            color: white;
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
            flex-shrink: 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 4px;
        }

        /* Category Manager */
        .category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--tab-bg);
            border-radius: 8px;
            font-size: 0.9em;
        }

        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .category-item button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1em;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        .category-item button:hover {
            color: #f56565;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 15px;
                height: calc(100vh - 10px);
            }

            .header h1 {
                font-size: 1.5em;
                flex-direction: column;
            }

            .controls {
                width: 100%;
            }

            .control-btn {
                flex: 1;
                justify-content: center;
                font-size: 0.85em;
                padding: 8px 12px;
            }

            .tabs, .view-selector {
                gap: 5px;
            }

            .tab-btn, .view-btn {
                padding: 8px 12px;
                font-size: 0.85em;
            }

            .day-card {
                min-width: 250px;
                max-width: 250px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .notification {
                right: 10px;
                left: 10px;
                min-width: auto;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }

            .calendar-day {
                min-height: 100px;
                padding: 5px;
            }

            .calendar-day-number {
                font-size: 0.9em;
            }

            .calendar-activity {
                font-size: 0.65em;
                padding: 2px 4px;
            }

            .month-header h2 {
                font-size: 1.3em;
            }

            .calendar-day-header {
                font-size: 0.75em;
                padding: 8px 2px;
            }
        }
    </style>
</head>
<body>
    <!-- Audio para notificações -->
    <audio id="notificationSound" preload="auto" loop>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjiR1/LMeSwFJHfH8N2QQAo=" type="audio/wav">
    </audio>

    <div class="container" id="cronograma">
        <div class="header">
            <div class="header-content">
                <h1>
                    <i class="bi bi-calendar-check"></i>
                    Cronograma de Atividades
                </h1>
                <p>Gestão Completa de Produtividade Pessoal</p>
            </div>
            <div class="controls">
                <button class="control-btn success" onclick="openAddModal()">
                    <i class="bi bi-plus-circle"></i> Nova Atividade
                </button>
                <button class="control-btn primary" onclick="openCategoryModal()">
                    <i class="bi bi-tags"></i> Categorias
                </button>
                <button class="control-btn primary" onclick="exportToPDF()">
                    <i class="bi bi-file-pdf"></i> PDF
                </button>
                <button class="control-btn primary" onclick="exportToImage()">
                    <i class="bi bi-image"></i> Imagem
                </button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                    <i class="bi bi-moon-stars-fill" id="theme-icon"></i>
                </button>
            </div>
        </div>

        <div class="view-selector">
            <button class="view-btn active" onclick="showView('days')">
                <i class="bi bi-calendar-day"></i> Por Dia
            </button>
            <button class="view-btn" onclick="showView('week')">
                <i class="bi bi-calendar-week"></i> Semana
            </button>
            <button class="view-btn" onclick="showView('month')">
                <i class="bi bi-calendar-month"></i> Mês
            </button>
        </div>

        <div id="days-view" class="content-wrapper">
            <div class="tabs">
                <button class="tab-btn active" onclick="showDay('segunda')">Segunda-feira</button>
                <button class="tab-btn" onclick="showDay('terca')">Terça-feira</button>
                <button class="tab-btn" onclick="showDay('quarta')">Quarta-feira</button>
                <button class="tab-btn" onclick="showDay('quinta')">Quinta-feira</button>
                <button class="tab-btn" onclick="showDay('sexta')">Sexta-feira</button>
                <button class="tab-btn" onclick="showDay('sabado')">Sábado</button>
                <button class="tab-btn" onclick="showDay('domingo')">Domingo</button>
            </div>

            <div id="segunda" class="day-content active"></div>
            <div id="terca" class="day-content"></div>
            <div id="quarta" class="day-content"></div>
            <div id="quinta" class="day-content"></div>
            <div id="sexta" class="day-content"></div>
            <div id="sabado" class="day-content"></div>
            <div id="domingo" class="day-content"></div>
        </div>

        <div id="week-view" class="content-wrapper">
            <div class="overview-container">
                <div class="overview-grid" id="overview-grid"></div>
            </div>
        </div>

        <div id="month-view" class="content-wrapper">
            <div class="month-container">
                <div class="month-header">
                    <button class="month-nav-btn" onclick="changeMonth(-1)">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <h2 id="monthTitle"></h2>
                    <button class="month-nav-btn" onclick="changeMonth(1)">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-grid" id="calendar-grid"></div>
            </div>
        </div>

        <div class="legend" id="legend"></div>
    </div>

    <!-- Modal Adicionar/Editar Atividade -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nova Atividade</h2>
                <button class="close-modal" onclick="closeActivityModal()">&times;</button>
            </div>
            <form id="activityForm">
                <input type="hidden" id="activityId">
                
                <div class="form-group">
                    <label for="activityTitle">Título da Atividade *</label>
                    <input type="text" id="activityTitle" required>
                </div>

                <div class="form-group">
                    <label>Dias da Semana *</label>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="segunda"> Segunda-feira
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="terca"> Terça-feira
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="quarta"> Quarta-feira
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="quinta"> Quinta-feira
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="sexta"> Sexta-feira
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="sabado"> Sábado
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: var(--tab-bg); border-radius: 8px; cursor: pointer;">
                            <input type="checkbox" name="activityDays" value="domingo"> Domingo
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <input type="checkbox" id="selectAllDays"> Todos os dias
                        </label>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="activityStartTime">Horário Início *</label>
                        <input type="time" id="activityStartTime" required>
                    </div>

                    <div class="form-group">
                        <label for="activityEndTime">Horário Fim</label>
                        <input type="time" id="activityEndTime">
                    </div>
                </div>

                <div class="form-group">
                    <label for="activityCategory">Categoria *</label>
                    <select id="activityCategory" required></select>
                </div>

                <div class="form-group">
                    <label for="activityDescription">Descrição (opcional)</label>
                    <textarea id="activityDescription"></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableReminder" checked>
                        Ativar lembretes (notificação + e-mail)
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-modal btn-cancel" onclick="closeActivityModal()">Cancelar</button>
                    <button type="submit" class="btn-modal btn-save">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Gerenciar Categorias -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciar Categorias</h2>
                <button class="close-modal" onclick="closeCategoryModal()">&times;</button>
            </div>

            <div class="form-group">
                <label for="newCategoryName">Nome da Nova Categoria</label>
                <input type="text" id="newCategoryName" placeholder="Ex: Lazer, Estudo...">
            </div>

            <div class="form-group">
                <label for="newCategoryColor">Cor da Categoria</label>
                <input type="color" id="newCategoryColor" value="#667eea">
            </div>

            <div class="form-group">
                <label for="newCategoryIcon">Ícone (Bootstrap Icons)</label>
                <input type="text" id="newCategoryIcon" placeholder="Ex: book, music-note, controller">
            </div>

            <button class="btn-modal btn-save" onclick="addCategory()" style="width: 100%; margin-bottom: 20px;">
                <i class="bi bi-plus-circle"></i> Adicionar Categoria
            </button>

            <div class="form-group">
                <label>Categorias Existentes</label>
                <div class="category-list" id="categoryList"></div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-modal btn-cancel" onclick="closeCategoryModal()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>

    <script>
        // Configuração do Google Sheets
        const GOOGLE_SHEETS_CONFIG = {
            spreadsheetId: 'S1DBm7oVRLWSZFXLDCrNRV_4_2dBlwmdj9NzChg6J9zRM', // ID da sua planilha Google Sheets
            apiKey: 'SUA_API_KEY_AQUI', // API Key do Google Cloud Console
            discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            scriptUrl: 'https://script.google.com/macros/s/AKfycbydpkpWdtLUMASuWz-f6Ag3GPzOiNOrFUW4sE5T8gSuktMzdF5c_FTTfo87pwVyuhhKuw/exec' // URL do seu Web App Google Apps Script
        };

        // Dados da aplicação
        let activities = [];
        let categories = [
            { id: 'work', name: 'Trabalho/Startup', color: '#4299e1', icon: 'briefcase', class: 'work' },
            { id: 'personal', name: 'Pessoal', color: '#48bb78', icon: 'person', class: 'personal' },
            { id: 'meeting', name: 'Reuniões', color: '#ed8936', icon: 'people', class: 'meeting' },
            { id: 'spiritual', name: 'Espiritual', color: '#9f7aea', icon: 'heart', class: 'spiritual' },
            { id: 'exercise', name: 'Exercício', color: '#f56565', icon: 'heart-pulse', class: 'exercise' },
            { id: 'free', name: 'Tempo Livre', color: '#a0aec0', icon: 'star', class: 'free' }
        ];

        const emailRecipients = [
            'godman.filipe@gmail.com',
            'filoliveira@gmail.com',
            'filipe.lima@msn.com',
            'filipe.oliver@yahoo.com'
        ];

        // Carregar dados do localStorage
        function loadData() {
            const savedActivities = localStorage.getItem('activities');
            const savedCategories = localStorage.getItem('categories');

            if (savedActivities) {
                activities = JSON.parse(savedActivities);
            } else {
                // Dados iniciais
                activities = [
                    { id: 1, days: ['segunda', 'terca', 'quarta', 'quinta', 'sexta'], startTime: '06:00', endTime: '', title: 'Acordar - TPS - RM', category: 'personal', description: '', reminder: true },
                    { id: 2, days: ['segunda', 'terca', 'quarta', 'quinta', 'sexta'], startTime: '07:00', endTime: '', title: 'Exercício Físico', category: 'exercise', description: '', reminder: true },
                    { id: 3, days: ['segunda', 'terca', 'quarta', 'quinta', 'sexta'], startTime: '08:00', endTime: '', title: 'Café da Manhã', category: 'personal', description: '', reminder: true },
                    { id: 4, days: ['segunda'], startTime: '09:00', endTime: '', title: 'Kickoff Meeting - Definição de Metas Semanais', category: 'meeting', description: '', reminder: true },
                    { id: 5, days: ['segunda'], startTime: '10:00', endTime: '12:00', title: 'Foco Total - Desenvolvimento SellaStay', category: 'work', description: '', reminder: true },
                    { id: 6, days: ['segunda', 'terca', 'quarta', 'quinta', 'sexta'], startTime: '12:00', endTime: '14:00', title: 'Intervalo do Almoço', category: 'personal', description: '', reminder: true },
                    { id: 7, days: ['segunda', 'terca', 'quarta', 'quinta', 'sexta'], startTime: '14:00', endTime: '16:30', title: 'Foco Total - Projetos Remunerados', category: 'work', description: '', reminder: true },
                    { id: 8, days: ['segunda', 'terca', 'quarta'], startTime: '16:30', endTime: '19:30', title: 'Foco Total - Sync ERP+', category: 'work', description: '', reminder: true },
                    { id: 9, days: ['segunda'], startTime: '19:30', endTime: '', title: 'Reunião de Jovens Adultos', category: 'spiritual', description: '', reminder: true },
                    { id: 10, days: ['segunda', 'terca', 'quarta', 'quinta'], startTime: '22:00', endTime: '', title: 'Preparar para Dormir', category: 'personal', description: '', reminder: true },
                ];
            }

            if (savedCategories) {
                categories = JSON.parse(savedCategories);
            }
        }

        // Salvar dados no localStorage
        function saveData() {
            localStorage.setItem('activities', JSON.stringify(activities));
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        // Renderizar atividades
        function renderActivities() {
            const days = ['segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado', 'domingo'];
            
            days.forEach(day => {
                const dayContainer = document.getElementById(day);
                const dayActivities = activities.filter(a => a.days && a.days.includes(day)).sort((a, b) => a.startTime.localeCompare(b.startTime));
                
                const timeline = document.createElement('div');
                timeline.className = 'timeline';
                
                dayActivities.forEach(activity => {
                    const category = categories.find(c => c.id === activity.category);
                    const event = document.createElement('div');
                    event.className = `event ${category.class}`;
                    
                    const timeText = activity.endTime ? `${activity.startTime} - ${activity.endTime}` : activity.startTime;
                    
                    event.innerHTML = `
                        <div class="event-time">
                            <i class="bi bi-${category.icon}"></i> ${timeText}
                        </div>
                        <div class="event-title">${activity.title}</div>
                        ${activity.description ? `<div class="event-title" style="margin-top: 5px; font-size: 0.85em; font-style: italic;">${activity.description}</div>` : ''}
                        <span class="event-tag tag-${category.class}">${category.name}</span>
                        <div class="event-actions">
                            <button class="btn-edit" onclick="editActivity(${activity.id})">
                                <i class="bi bi-pencil"></i> Editar
                            </button>
                            <button class="btn-delete" onclick="deleteActivity(${activity.id})">
                                <i class="bi bi-trash"></i> Excluir
                            </button>
                        </div>
                    `;
                    
                    timeline.appendChild(event);
                });
                
                dayContainer.innerHTML = '';
                dayContainer.appendChild(timeline);
            });

            renderOverview();
            renderLegend();
        }

        // Renderizar visão geral
        function renderOverview() {
            const days = [
                { id: 'segunda', name: 'Segunda-feira' },
                { id: 'terca', name: 'Terça-feira' },
                { id: 'quarta', name: 'Quarta-feira' },
                { id: 'quinta', name: 'Quinta-feira' },
                { id: 'sexta', name: 'Sexta-feira' },
                { id: 'sabado', name: 'Sábado' },
                { id: 'domingo', name: 'Domingo' }
            ];

            const grid = document.getElementById('overview-grid');
            grid.innerHTML = '';

            days.forEach(day => {
                const dayActivities = activities.filter(a => a.days && a.days.includes(day.id)).sort((a, b) => a.startTime.localeCompare(b.startTime));
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                let eventsHTML = '';
                dayActivities.forEach(activity => {
                    const category = categories.find(c => c.id === activity.category);
                    const timeText = activity.endTime ? `${activity.startTime}-${activity.endTime}` : activity.startTime;
                    
                    eventsHTML += `
                        <div class="event ${category.class}">
                            <div class="event-time"><i class="bi bi-${category.icon}"></i> ${timeText}</div>
                            <div class="event-title">${activity.title}</div>
                        </div>
                    `;
                });

                dayCard.innerHTML = `
                    <h3><i class="bi bi-calendar"></i> ${day.name}</h3>
                    ${eventsHTML}
                `;
                
                grid.appendChild(dayCard);
            });
        }

        // Renderizar legenda
        function renderLegend() {
            const legend = document.getElementById('legend');
            legend.innerHTML = '';

            categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <div class="legend-color" style="background: ${cat.color};"></div>
                    <span>${cat.name}</span>
                `;
                legend.appendChild(item);
            });
        }

        // Abrir modal de adicionar
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Nova Atividade';
            document.getElementById('activityForm').reset();
            document.getElementById('activityId').value = '';
            populateCategorySelect();
            document.getElementById('activityModal').classList.add('active');
        }

        // Editar atividade
        function editActivity(id) {
            const activity = activities.find(a => a.id === id);
            if (!activity) return;

            document.getElementById('modalTitle').textContent = 'Editar Atividade';
            document.getElementById('activityId').value = activity.id;
            document.getElementById('activityTitle').value = activity.title;
            
            // Marcar os dias selecionados
            document.querySelectorAll('input[name="activityDays"]').forEach(checkbox => {
                checkbox.checked = activity.days && activity.days.includes(checkbox.value);
            });
            
            document.getElementById('activityStartTime').value = activity.startTime;
            document.getElementById('activityEndTime').value = activity.endTime || '';
            document.getElementById('activityCategory').value = activity.category;
            document.getElementById('activityDescription').value = activity.description || '';
            document.getElementById('enableReminder').checked = activity.reminder;

            populateCategorySelect();
            document.getElementById('activityModal').classList.add('active');
        }

        // Deletar atividade
        function deleteActivity(id) {
            if (!confirm('Deseja realmente excluir esta atividade?')) return;

            activities = activities.filter(a => a.id !== id);
            deleteActivityFromSheets(id);
            saveData();
            renderActivities();
            showNotification('Atividade excluída com sucesso!', 'success');
        }

        // Fechar modal de atividade
        function closeActivityModal() {
            document.getElementById('activityModal').classList.remove('active');
        }

        // Salvar atividade
        document.getElementById('activityForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const id = document.getElementById('activityId').value;
            const title = document.getElementById('activityTitle').value;
            
            // Coletar dias selecionados
            const selectedDays = Array.from(document.querySelectorAll('input[name="activityDays"]:checked'))
                .map(cb => cb.value);
            
            if (selectedDays.length === 0) {
                showNotification('Selecione pelo menos um dia da semana!', 'error');
                return;
            }
            
            const startTime = document.getElementById('activityStartTime').value;
            const endTime = document.getElementById('activityEndTime').value;
            const category = document.getElementById('activityCategory').value;
            const description = document.getElementById('activityDescription').value;
            const reminder = document.getElementById('enableReminder').checked;

            if (id) {
                // Editar
                const activity = activities.find(a => a.id == id);
                activity.title = title;
                activity.days = selectedDays;
                activity.startTime = startTime;
                activity.endTime = endTime;
                activity.category = category;
                activity.description = description;
                activity.reminder = reminder;
                
                // Atualizar no Google Sheets
                updateActivityInSheets(activity);
                showNotification('Atividade atualizada com sucesso!', 'success');
            } else {
                // Adicionar
                const newActivity = {
                    id: Date.now(),
                    title,
                    days: selectedDays,
                    startTime,
                    endTime,
                    category,
                    description,
                    reminder
                };
                activities.push(newActivity);
                
                // Adicionar no Google Sheets
                addActivityToSheets(newActivity);
                showNotification('Atividade adicionada com sucesso!', 'success');
            }

            saveData();
            renderActivities();
            closeActivityModal();
        });

        // Selecionar/Desselecionar todos os dias
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('selectAllDays').addEventListener('change', function(e) {
                const checkboxes = document.querySelectorAll('input[name="activityDays"]');
                checkboxes.forEach(cb => cb.checked = e.target.checked);
            });
        });

        // Popular select de categorias
        function populateCategorySelect() {
            const select = document.getElementById('activityCategory');
            select.innerHTML = '';

            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name;
                select.appendChild(option);
            });
        }

        // Gerenciar categorias
        function openCategoryModal() {
            renderCategoryList();
            document.getElementById('categoryModal').classList.add('active');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        function renderCategoryList() {
            const list = document.getElementById('categoryList');
            list.innerHTML = '';

            categories.forEach(cat => {
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="category-color" style="background: ${cat.color};"></div>
                    <i class="bi bi-${cat.icon}"></i>
                    <span>${cat.name}</span>
                    <button onclick="deleteCategory('${cat.id}')" title="Excluir">
                        <i class="bi bi-x-circle"></i>
                    </button>
                `;
                list.appendChild(item);
            });
        }

        function addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            const color = document.getElementById('newCategoryColor').value;
            const icon = document.getElementById('newCategoryIcon').value.trim();

            if (!name || !icon) {
                showNotification('Preencha o nome e ícone da categoria!', 'error');
                return;
            }

            const newCategory = {
                id: name.toLowerCase().replace(/\s+/g, '_'),
                name,
                color,
                icon,
                class: name.toLowerCase().replace(/\s+/g, '_')
            };

            categories.push(newCategory);
            saveData();
            renderCategoryList();
            renderActivities();

            document.getElementById('newCategoryName').value = '';
            document.getElementById('newCategoryIcon').value = '';
            showNotification('Categoria adicionada com sucesso!', 'success');
        }

        function deleteCategory(id) {
            const hasActivities = activities.some(a => a.category === id);
            if (hasActivities) {
                showNotification('Não é possível excluir categoria com atividades!', 'error');
                return;
            }

            if (!confirm('Deseja realmente excluir esta categoria?')) return;

            categories = categories.filter(c => c.id !== id);
            saveData();
            renderCategoryList();
            renderActivities();
            showNotification('Categoria excluída com sucesso!', 'success');
        }

        // Sistema de notificações
        function showNotification(message, type = 'success', duration = 3000) {
            const notification = document.getElementById('notification');
            notification.className = `notification ${type} show`;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'error' ? 'x-circle' : 
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';
            
            notification.innerHTML = `
                <div class="notification-header">
                    <i class="bi bi-${icon}"></i>
                    ${type === 'success' ? 'Sucesso!' : type === 'error' ? 'Erro!' : 'Aviso!'}
                </div>
                <div class="notification-body">${message}</div>
            `;

            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        // Sistema de lembretes
        function checkReminders() {
            const now = new Date();
            const currentDay = ['domingo', 'segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado'][now.getDay()];
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

            activities.forEach(activity => {
                if (activity.days && activity.days.includes(currentDay) && activity.startTime === currentTime && activity.reminder) {
                    showReminder(activity);
                }
            });
        }

        function showReminder(activity) {
            const category = categories.find(c => c.id === activity.category);
            
            // Som
            const sound = document.getElementById('notificationSound');
            sound.play().catch(err => console.log('Erro ao reproduzir som:', err));

            // Notificação visual
            const notification = document.getElementById('notification');
            notification.className = 'notification reminder show';
            notification.innerHTML = `
                <div class="notification-header">
                    <i class="bi bi-alarm"></i>
                    LEMBRETE DE ATIVIDADE!
                </div>
                <div class="notification-body">
                    <strong>${activity.startTime}</strong> - ${activity.title}<br>
                    <small>${category.name}</small>
                </div>
            `;

            sound.loop = true;          // garante repetição
            sound.play().catch(() => {});   // inicia o som

            // pare o som quando o lembrete for fechado (10 s)
            setTimeout(() => {
                sound.pause();
                sound.currentTime = 0;  // reinicia
            }, 10000);

            setTimeout(() => {
                notification.classList.remove('show');
            }, 10000);

            // Notificação do navegador
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("Cronograma Manager - Lembrete", {
                    body: `${activity.startTime} - ${activity.title}`,
                    icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>⏰</text></svg>"
                });
            }

            // Enviar e-mail via Google Apps Script
            sendReminderEmailViaSheets(activity, category);
        }

        // Funções de integração com Google Sheets
        function addActivityToSheets(activity) {
            fetch(GOOGLE_SHEETS_CONFIG.scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'addActivity',
                    data: activity
                })
            }).catch(error => console.error('Erro ao adicionar atividade:', error));
        }

        function updateActivityInSheets(activity) {
            fetch(GOOGLE_SHEETS_CONFIG.scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'updateActivity',
                    data: activity
                })
            }).catch(error => console.error('Erro ao atualizar atividade:', error));
        }

        function deleteActivityFromSheets(activityId) {
            fetch(GOOGLE_SHEETS_CONFIG.scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'deleteActivity',
                    id: activityId
                })
            }).catch(error => console.error('Erro ao deletar atividade:', error));
        }

        function sendReminderEmailViaSheets(activity, category) {
            const timeText = activity.endTime ? `${activity.startTime} - ${activity.endTime}` : activity.startTime;
            
            fetch(GOOGLE_SHEETS_CONFIG.scriptUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'sendReminderEmail',
                    data: {
                        recipients: emailRecipients,
                        activity_title: activity.title,
                        activity_time: timeText,
                        activity_category: category.name,
                        activity_description: activity.description || 'Sem descrição',
                        activity_days: activity.days.join(', ')
                    }
                })
            })
            .then(() => console.log('E-mail de lembrete enviado com sucesso!'))
            .catch(error => console.error('Erro ao enviar e-mail:', error));
        }

        // Carregar atividades do Google Sheets
        function loadActivitiesFromSheets() {
            fetch(GOOGLE_SHEETS_CONFIG.scriptUrl + '?action=getActivities')
                .then(response => response.json())
                .then(data => {
                    if (data && data.activities) {
                        activities = data.activities;
                        saveData();
                        renderActivities();
                    }
                })
                .catch(error => console.error('Erro ao carregar atividades:', error));
        }

        // Solicitar permissão para notificações
        function requestNotificationPermission() {
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission();
            }
        }

        // Tema
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            
            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                icon.className = 'bi bi-moon-stars-fill';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'bi bi-sun-fill';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Carregar tema salvo
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const icon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                icon.className = 'bi bi-sun-fill';
            }

            loadData();
            renderActivities();
            requestNotificationPermission();
            renderMonthView();

            // Verificar lembretes a cada minuto
            setInterval(checkReminders, 60000);
            checkReminders(); // Verificar imediatamente
        });

        // Navegação
        function showDay(day) {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.day-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(day).classList.add('active');
        }

        // Estado do calendário mensal
        let currentMonthDate = new Date();

        function showView(view) {
            const viewBtns = document.querySelectorAll('.view-btn');
            viewBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const daysView = document.getElementById('days-view');
            const weekView = document.getElementById('week-view');
            const monthView = document.getElementById('month-view');
            const overviewContainer = document.querySelector('.overview-container');
            const monthContainer = document.querySelector('.month-container');

            // Esconder todas as views
            daysView.style.display = 'none';
            weekView.style.display = 'none';
            monthView.style.display = 'none';
            overviewContainer.classList.remove('active');
            monthContainer.classList.remove('active');

            // Mostrar a view selecionada
            if (view === 'days') {
                daysView.style.display = 'block';
            } else if (view === 'week') {
                weekView.style.display = 'block';
                overviewContainer.classList.add('active');
            } else if (view === 'month') {
                monthView.style.display = 'block';
                monthContainer.classList.add('active');
                renderMonthView();
            }
        }

        function changeMonth(direction) {
            currentMonthDate.setMonth(currentMonthDate.getMonth() + direction);
            renderMonthView();
        }

        function renderMonthView() {
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            const dayMapping = ['domingo', 'segunda', 'terca', 'quarta', 'quinta', 'sexta', 'sabado'];

            // Atualizar título
            document.getElementById('monthTitle').textContent = 
                `${monthNames[currentMonthDate.getMonth()]} ${currentMonthDate.getFullYear()}`;

            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            // Adicionar cabeçalhos dos dias
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Calcular primeiro e último dia do mês
            const firstDay = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth(), 1);
            const lastDay = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth() + 1, 0);
            
            // Dias do mês anterior para preencher a primeira semana
            const firstDayOfWeek = firstDay.getDay();
            const prevMonthLastDay = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth(), 0).getDate();
            
            // Adicionar dias do mês anterior
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const dayCell = createDayCell(day, dayMapping[(firstDayOfWeek - i - 1 + 7) % 7], true);
                grid.appendChild(dayCell);
            }

            // Adicionar dias do mês atual
            const today = new Date();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth(), day);
                const dayOfWeek = date.getDay();
                const isToday = today.getDate() === day && 
                               today.getMonth() === currentMonthDate.getMonth() && 
                               today.getFullYear() === currentMonthDate.getFullYear();
                
                const dayCell = createDayCell(day, dayMapping[dayOfWeek], false, isToday);
                grid.appendChild(dayCell);
            }

            // Adicionar dias do próximo mês
            const remainingCells = 42 - (firstDayOfWeek + lastDay.getDate());
            for (let day = 1; day <= remainingCells; day++) {
                const dayOfWeek = (lastDay.getDay() + day) % 7;
                const dayCell = createDayCell(day, dayMapping[dayOfWeek], true);
                grid.appendChild(dayCell);
            }
        }

        function createDayCell(dayNumber, dayName, isOtherMonth = false, isToday = false) {
            const cell = document.createElement('div');
            cell.className = 'calendar-day';
            
            if (isOtherMonth) {
                cell.classList.add('other-month');
            }
            
            if (isToday) {
                cell.classList.add('today');
            }

            const dayNumberDiv = document.createElement('div');
            dayNumberDiv.className = 'calendar-day-number';
            dayNumberDiv.textContent = dayNumber;
            cell.appendChild(dayNumberDiv);

            if (!isOtherMonth) {
                // Filtrar atividades para este dia da semana
                const dayActivities = activities
                    .filter(a => a.days && a.days.includes(dayName))
                    .sort((a, b) => a.startTime.localeCompare(b.startTime))
                    .slice(0, 3); // Mostrar apenas as 3 primeiras

                dayActivities.forEach(activity => {
                    const category = categories.find(c => c.id === activity.category);
                    const activityDiv = document.createElement('div');
                    activityDiv.className = `calendar-activity ${category.class}`;
                    activityDiv.textContent = `${activity.startTime} ${activity.title}`;
                    activityDiv.title = `${activity.startTime} - ${activity.title}\n${category.name}`;
                    cell.appendChild(activityDiv);
                });

                // Mostrar contagem se houver mais atividades
                const totalActivities = activities.filter(a => a.days && a.days.includes(dayName)).length;
                if (totalActivities > 3) {
                    const countDiv = document.createElement('div');
                    countDiv.className = 'activity-count';
                    countDiv.textContent = `+${totalActivities - 3} mais`;
                    cell.appendChild(countDiv);
                }
            }

            return cell;
        }

        // Exportar
        function exportToPDF() {
            const element = document.getElementById('cronograma');
            const opt = {
                margin: 10,
                filename: 'cronograma-semanal-sellastay.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save();
            showNotification('PDF gerado com sucesso!', 'success');
        }

        async function exportToImage() {
            const element = document.getElementById('cronograma');
            
            try {
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: null
                });

                const imgData = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'cronograma-semanal-sellastay.png';
                link.href = imgData;
                link.click();
                
                showNotification('Imagem exportada com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao exportar imagem:', error);
                showNotification('Erro ao exportar imagem!', 'error');
            }
        }
    </script>
</body>
</html>
